<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script src="https://maps.google.com/maps/api/js?sensor=false&libraries=places"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
<!-- build:js scripts/ng-map.min.js -->
<script src="../app/scripts/app.js"></script>
<script src="../app/scripts/directives/map_controller.js"></script>
<script src="../app/scripts/directives/map.js"></script>
<script src="../app/scripts/services/geo_coder.js"></script>
<script src="../app/scripts/services/navigator_geolocation.js"></script>
<script src="../app/scripts/services/attr2_options.js"></script>
<script src="../app/scripts/directives/street-view-panorama.js"></script>
<script src="../app/scripts/directives/places-auto-complete.js"></script>
<script src="../app/scripts/directives/directions.js"></script>
<!-- endbuild -->
<style>
  html, body {height: 100%}
  map, #streetview {display:block; float:left; width: 45%; height: 80%}
  button {background-color: grey}
</style>
<script>
  angular.module('myApp', ['ngMap'])
   .controller('MyCtrl', function($scope, $interval) {
     $scope.origin = "toronto on, canada";
     $scope.destination = "ottawa on, canada";
     $scope.interval = 5000;
     $scope.directionsChanged = function() {
       $scope.paths = this.directions.routes[0].overview_path;
       $scope.map.getStreetView().setPosition($scope.paths[0]);
     }

     var ndx=0, autoplay;
     var play = function() {
       autoplay = $interval(function() {
         $scope.showStreetView(1);
       }, $scope.interval);
     };

     $scope.showStreetView = function(variation) {
       var svp = $scope.map.getStreetView();
       if ($scope.paths && svp) {
         ndx += variation;
         svp.setPosition($scope.paths[ndx]);
       }
     }

     $scope.playOrStop = function() {
       $scope.play = !!!$scope.play;
       console.log($scope.play);
       $scope.play ? play() : $interval.cancel(autoplay);
     };

   });
</script>
</head>

<body ng-app="myApp" ng-controller="MyCtrl">
  <h2> Virtual Road Trip with ngMap StreetView</h2>
  <div style="positon:absolute;">
    Origin: <input places-auto-complete ng-model="origin" size=40 /> --&gt; 
    Destination: <input places-auto-complete ng-model="destination" size=40 /> 
    <br/>
    <button ng-click="showStreetView(-1)">Prev</button>
    <button ng-click="playOrStop()">Play/Stop</button>
    <button ng-click="showStreetView(1)">Next</button>
    Interval: <select ng-model="interval">
      <option value="5000">5 seconds</option>
      <option value="10000">10 seconds</option>
      <option value="15000">15 seconds</option>
    </select>
  </div>
  <map zoom="18" center="current-position" map-type-id="MapTypeId.SATELLITE" tilt="45">
    <directions 
      draggable="true"
      panel="directions-panel"
      origin="{{origin}}"
      on-directions_changed="directionsChanged(evt)"
      destination="{{destination}}">
    </directions>
    <street-view-panorama container="streetview"></street-view-panorama>
 </map>
 <div id="streetview"></div> 
 <br style="clear:both" />
 <div id="directions-panel"></div>
</body>
</html>
