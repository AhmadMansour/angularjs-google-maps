var ngMap={services:{},directives:{}};ngMap.services.Attr2Options=function($parse,NavigatorGeolocation,GeoCoder){var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,camelCase=function(e){return e.replace(SPECIAL_CHARS_REGEXP,function(e,t,o,n){return n?o.toUpperCase():o}).replace(MOZ_HACK_REGEXP,"Moz$1")},toOptionValue=function(input,options){var output,key=options.key,scope=options.scope;try{var num=Number(input);if(isNaN(num))throw"Not a number";output=num}catch(err){try{if(output=JSON.parse(input),output instanceof Array){if(!(output[0]instanceof Array))return new google.maps.LatLng(output[0],output[1]);output=output.map(function(e){return new google.maps.LatLng(e[0],e[1])})}}catch(err2){if(input.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/))try{var exp="new google.maps."+input;output=eval(exp)}catch(e){output=input}else if(input.match(/^[A-Z][a-zA-Z0-9]+\.[A-Z]+$/))try{output=scope.$eval("google.maps."+input)}catch(e){output=input}else if(input.match(/^[A-Z]+$/))try{var capitializedKey=key.charAt(0).toUpperCase()+key.slice(1);output=scope.$eval("google.maps."+capitializedKey+"."+input)}catch(e){output=input}else output=input}}return output},setDelayedGeoLocation=function(e,t,o,n){!o||o.match(/^current/i)?NavigatorGeolocation.getCurrentPosition().then(function(o){var n=o.coords.latitude,a=o.coords.longitude,r=new google.maps.LatLng(n,a);e[t](r),e.centered&&e.map.setCenter(r)},function(){e[t](n)}):GeoCoder.geocode({address:o}).then(function(o){e[t](o[0].geometry.location),e.centered&&e.map.setCenter(o[0].geometry.location)})},observeAndSet=function(e,t,o){e.$observe(t,function(e){if(e){var n=camelCase("set-"+t),a=toOptionValue(e,{key:t});o[n]&&(t.match(/center|position/)&&"string"==typeof a?setDelayedGeoLocation(o,n,a):o[n](a))}})};return{filter:function(e){var t={};for(var o in e)o.match(/^\$/)||(t[o]=e[o]);return t},getOptions:function(e,t){var o={};for(var n in e)if(e[n]){if(n.match(/^on[A-Z]/))continue;if(n.match(/ControlOptions$/))continue;o[n]=toOptionValue(e[n],{scope:t,key:n})}return o},getEvents:function(e,t){var o={},n=function(e){return"_"+e.toLowerCase()},a=function(t){var o=t.match(/([^\(]+)\(([^\)]*)\)/),n=o[1],a=o[2].replace(/event[ ,]*/,""),r=e.$eval("["+a+"]");return function(t){e[n].apply(this,[t].concat(r))}};for(var r in t)if(t[r]){if(!r.match(/^on[A-Z]/))continue;var i=r.replace(/^on/,"");i=i.charAt(0).toLowerCase()+i.slice(1),i=i.replace(/([A-Z])/g,n);var s=t[r];o[i]=new a(s)}return o},getControlOptions:function(e){var t={};if("object"!=typeof e)return!1;for(var o in e)if(e[o]){if(!o.match(/(.*)ControlOptions$/))continue;var n=e[o],a=n.replace(/'/g,'"');a=a.replace(/([^"]+)|("[^"]+")/g,function(e,t,o){return t?t.replace(/([a-zA-Z0-9]+?):/g,'"$1":'):o});try{var r=JSON.parse(a);for(var i in r)if(r[i]){var s=r[i];if("string"==typeof s?s=s.toUpperCase():"mapTypeIds"===i&&(s=s.map(function(e){return google.maps.MapTypeId[e.toUpperCase()]})),"style"===i){var p=o.charAt(0).toUpperCase()+o.slice(1),c=p.replace(/Options$/,"")+"Style";r[i]=google.maps[c][s]}else r[i]="position"===i?google.maps.ControlPosition[s]:s}t[o]=r}catch(l){}}return t},getAttrsToObserve:function(e){var t=[];if(e["ng-repeat"]||e.ngRepeat);else for(var o in e){var n=e[o];n&&n.match(/\{\{.*\}\}/)&&t.push(camelCase(o))}return t},toOptionValue:toOptionValue,camelCase:camelCase,setDelayedGeoLocation:setDelayedGeoLocation,observeAndSet:observeAndSet}},ngMap.services.Attr2Options.$inject=["$parse","NavigatorGeolocation","GeoCoder"],ngMap.services.GeoCoder=function(e){return{geocode:function(t){var o=e.defer(),n=new google.maps.Geocoder;return n.geocode(t,function(e,t){t==google.maps.GeocoderStatus.OK?o.resolve(e):o.reject("Geocoder failed due to: "+t)}),o.promise}}},ngMap.services.GeoCoder.$inject=["$q"],ngMap.services.NavigatorGeolocation=function(e){return{getCurrentPosition:function(){var t=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject("Browser Geolocation service failed."),t.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}},ngMap.services.NavigatorGeolocation.$inject=["$q"],ngMap.services.StreetView=function(e){return{getPanorama:function(t,o){o=o||t.getCenter();var n=e.defer(),a=new google.maps.StreetViewService;return a.getPanoramaByLocation(o||t.getCenter,100,function(e,t){t===google.maps.StreetViewStatus.OK?n.resolve(e.location.pano):n.resolve(!1)}),n.promise},setPanorama:function(e,t){var o=new google.maps.StreetViewPanorama(e.getDiv(),{enableCloseButton:!0});o.setPano(t)}}},ngMap.services.StreetView.$inject=["$q"],ngMap.directives.map=function(e){var t=e;return{restrict:"AE",controller:ngMap.directives.MapController,link:function(o,n,a,r){o.google=google;var i=document.createElement("div");i.style.width="100%",i.style.height="100%",n.prepend(i);var s=t.filter(a),p=t.getOptions(s,o),c=t.getControlOptions(s),l=angular.extend(p,c);l.zoom=l.zoom||15;for(var u={},g=0;g<n[0].attributes.length;g++){var v=n[0].attributes[g];u[v.name]=v.value}var m=new google.maps.Map(i,{});m.markers={},m.shapes={};var f=l.center;f instanceof google.maps.LatLng||(delete p.center,e.setDelayedGeoLocation(m,"setCenter",f,p.geoFallbackCenter)),m.setOptions(p);var d=t.getEvents(o,s);for(var h in d)h&&google.maps.event.addListener(m,h,d[h]);for(var y=t.getAttrsToObserve(u),g=0;g<y.length;g++)t.observeAndSet(a,y[g],m);r.map=m,r.addObjects(r._objects),o.map=m,o.$emit("mapInitialized",o.map),o.maps=o.maps||{},o.maps[p.id||Object.keys(o.maps).length]=m,o.$emit("mapsInitialized",o.maps)}}},ngMap.directives.map.$inject=["Attr2Options"],ngMap.directives.MapController=function(){this.map=null,this._objects=[],this.addMarker=function(e){if(this.map){this.map.markers=this.map.markers||{},e.setMap(this.map),e.centered&&this.map.setCenter(e.position);var t=Object.keys(this.map.markers).length;this.map.markers[e.id||t]=e}else this._objects.push(e)},this.addShape=function(e){if(this.map){this.map.shapes=this.map.shapes||{},e.setMap(this.map);var t=Object.keys(this.map.shapes).length;this.map.shapes[e.id||t]=e}else this._objects.push(e)},this.addObjects=function(e){for(var t=0;t<e.length;t++){var o=e[t];o instanceof google.maps.Marker?this.addMarker(o):(o instanceof google.maps.Circle||o instanceof google.maps.Polygon||o instanceof google.maps.Polyline||o instanceof google.maps.Rectangle||o instanceof google.maps.GroundOverlay)&&this.addShape(o)}}},ngMap.directives.MapController.$inject=["$scope"],ngMap.directives.marker=function(e){var t=e,o=function(e,o){var n;if(e.position instanceof google.maps.LatLng)n=new google.maps.Marker(e);else{var a=e.position;e.position=new google.maps.LatLng(0,0),n=new google.maps.Marker(e),t.setDelayedGeoLocation(n,"setPosition",a)}Object.keys(o).length>0;for(var r in o)r&&google.maps.event.addListener(n,r,o[r]);return n};return{restrict:"AE",require:"^map",link:function(e,n,a,r){var i=t.filter(a),s=t.getOptions(i,e),p=t.getEvents(e,i);s.ngRepeat&&n.bind("$destroy",function(){var e=g.map.markers;for(var t in e)e[t]==g&&delete e[t];g.setMap(null)});for(var c={},l=0;l<n[0].attributes.length;l++){var u=n[0].attributes[l];c[u.name]=u.value}var g=o(s,p);r.addMarker(g);for(var v=t.getAttrsToObserve(c),l=0;l<v.length;l++)t.observeAndSet(a,v[l],g)}}},ngMap.directives.marker.$inject=["Attr2Options"],ngMap.directives.shape=function(e){var t=e,o=function(e){return new google.maps.LatLngBounds(e[0],e[1])},n=function(e,t){var n,a=e.name;switch(delete e.name,a){case"circle":n=new google.maps.Circle(e);break;case"polygon":n=new google.maps.Polygon(e);break;case"polyline":n=new google.maps.Polyline(e);break;case"rectangle":e.bounds=o(e.bounds),n=new google.maps.Rectangle(e);break;case"groundOverlay":case"image":var r=e.url,i=o(e.bounds),s={opacity:e.opacity,clickable:e.clickable,id:e.id};n=new google.maps.GroundOverlay(r,i,s)}for(var p in t)t[p]&&google.maps.event.addListener(n,p,t[p]);return n};return{restrict:"AE",require:"^map",link:function(e,o,a,r){var i=t.filter(a),s=t.getOptions(i),p=t.getEvents(e,i),c=n(s,p);r.addShape(c);for(var l={},u=0;u<o[0].attributes.length;u++){var g=o[0].attributes[u];l[g.name]=g.value}for(var v=t.getAttrsToObserve(l),u=0;u<v.length;u++)t.observeAndSet(a,v[u],c)}}},ngMap.directives.shape.$inject=["Attr2Options"];var ngMapModule=angular.module("ngMap",[]);for(var key in ngMap.services)ngMapModule.service(key,ngMap.services[key]);for(var key in ngMap.directives)"MapController"!=key&&ngMapModule.directive(key,ngMap.directives[key]);